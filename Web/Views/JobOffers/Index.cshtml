@model IEnumerable<HR.DataAccess.Models.JobOffer>

@{
    ViewData["Title"] = "Index";
}

<h2>Job offers list</h2>

<p>
    <a style="float: right; margin-bottom:5px" class="btn btn-primary " asp-action="Create">Create New</a>
</p>



<div id="updatePanel">

</div>


@section Scripts{
    <script>
        var currentPage = 1;
        $(document).ready(function () {
            fetchData(1);
        });
        function fetchData(pageNo) {
            var $loading = "<div class='loading'>Please wait...</div>";
         //   $('#updatePanel').prepend($loading);
            $.ajax({
                url: 'api/GetJobOffers',
                type: 'GET',
                data: { pageNo: pageNo },
                dataType: 'json',
                success: function (data) {
                    var $table = $('<table/>').addClass('table table-striped table-bordered table-hover');
                    var $header = $('<thead/>').html('<tr><th >Id</th><th >Position</th><th >Company</th></tr>');
                    $table.append($header);
                    var $tbody = $('<tbody/>').html('');
                    $.each(data.offers, function (i, emp) {
                        var $row = $('<tr/>');
                        $row.append($('<td/>').html(emp.id));
                        $row.append($('<td/>').html(emp.position));
                        $row.append($('<td/>').html(emp.company));
                        $row.append($('<td width ="150"/>').html(
                            `<a class="btn btn-primary btn-sm"  href=@Url.Action("Edit","JobOffers")/${emp.id}>Edit</a>`+
                            `  <a class="btn btn-primary btn-sm"  href=@Url.Action("Delete","JobOffers")/${emp.id}>Delete</a>`


                        ));

                        $tbody.append($row);
                    });

                    $table.append($tbody);
                    var totalPage = parseInt(data.totalPage);
                    console.log(totalPage)
                    var $footer = $('<tr/>');
                    var $footerTD = $('<td align="right" />').attr('colspan', 4).addClass('footerContent');
                    currentPage = pageNo;

                    $footerTD.append("Strona: ");
                    if (totalPage > 0) {
                        for (var i = 1; i <= totalPage; i++) {
                            var $page = $('<span/>').addClass((i == currentPage) ? "current" : "");
                            $page.html((i == currentPage) ? "<button style class='btn-sm btn-primary' onclick='fetchData(" + i + ");'>" + i + "</button>" : "<button class='btn-sm btn-secondary' onclick='fetchData(" + i + ");'>" + i + "</button>");
                            $footerTD.append($page);
                        }
                        $footer.append($footerTD);
                    }
                    $table.append($footer);

                    $('#updatePanel').html($table);
                },
                error: function () {
                    alert('Error! Please try again.');
                }
            }).done(function () {

             //   $loading.remove();
            });
        }
    </script>
}
